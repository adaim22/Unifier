<script>
    function fetchProfile() {
        const headers = [];
        const body = null;

        function onSuccess(xhr, xhrResponse, xhrResponseType) {
            console.log(`Successfully fetched profile!`);
        }

        function onFailure(xhr, xhrStatus) {
            console.log(`Failed to fetch profile: ${xhrStatus}`);
        }

        var profileInfo = [];
        var cookie = document.cookie;
        var baseUrl = 'http://localhost:5000/api/readProfile?'
        var finalUrl = baseUrl.concat(cookie)
        profileInfo = REST(finalUrl, 'GET', true, 0, headers, body, onSuccess, onFailure);

        document.getElementById("bioPar").innerHTML = profileInfo[4];
        document.getElementById("bioImg").src = profileInfo[7];
    }

    function fetchFriends() {
        const headers = [];
        const body = null;

        function onSuccess(xhr, xhrResponse, xhrResponseType) {
            console.log(`Successfully fetched friends!`);
        }

        function onFailure(xhr, xhrStatus) {
            console.log(`Failed to fetch friends: ${xhrStatus}`);
        }

        var friendIds = [];
        baseUrl = 'http://localhost:5000/api/friends?'
        finalUrl = baseUrl.concat(cookie)
        friendsIds = REST(finalUrl, 'GET', true, 0, headers, body, onSuccess, onFailure);

        if (friendsIds.length == 0) {
            return;
        }

        else {
            for (var i = 0; i < friendsIds.length; i++) {
                if (i != 0) {
                    var itm = document.getElementById("friendList").lastChild;
                    var cln = itm.cloneNode(true);
                    document.getElementById("friendList").appendChild(cln);
                }
                
                var cookie = friendsIds[i];
                var baseUrl = 'http://localhost:5000/api/readProfile?uid='
                var finalUrl = baseUrl.concat(cookie)
                friend = REST(finalUrl, 'GET', true, 0, headers, body, onSuccess, onFailure);

                document.getElementById("friendList").lastElementChild.innerHTML = friend[4];
                document.getElementById("friendList").lastElementChild.src = friend[7];
                //document.getElementById("friendList").lastElementChild.href = '#';
            }
        }

    }

    fetchProfile();
    fetchFriends();

</script>

<style>
    body {
        background-color: #32424b !important;
    }

    .page-header {
        color: #fbf0c1;
        font-size: large;
        font-weight: bold;
    }

    .card {
        background: #65cbb6;
    }

    .card-header {
        color: #32424b;
        font-weight: bold;
    }

    .list-group-item {
        background: #fbf0c1;
    }

    .profilepicture {
        width: 50%;
    }

    .equal {
        display: flex;
        flex-wrap: wrap;
    }

    .profile-link {
        text-decoration: none;
    }

    .offline {
        color: #B22222;
    }

    .online {
        color: #008000;
    }

</style>
<div class="container-fluid text-center ">
    <div class="page-header">
        <h1>Dashboard</h1>
    </div>
    <div class="row equal">
        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
            <div class="card">
                <div class="card-header">
                    <h1>Profile</h1>
                    <small><a href="/edit.html">Edit</a></small>
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><img id="bioImg" src="/profile-picture-test.png"
                            class="img-thumbnail profilepicture" alt="test profile picture"></li>
                    <li class="list-group-item">
                        <h3>Description:</h3>
                        <p id="bioPar">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
                            tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
                            quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
                            consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse
                            cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
                            proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                    </li>
                </ul>
            </div>
            <br>
            <div>
                <a href="/conversation.html"><button type="button" class="btn btn-primary btn-lg">Messages</button></a>
            </div>
            <br>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
            <div class="card">
                <div class="card-header">
                    <h1>Friends List</h1>
                </div>
                <ul class="list-group list-group-flush" id="friendList">
                    <li class="list-group-item">
                        <div class="d-flex justify-content-evenly">
                            <img src="/friend-1.png" class="flex-shrink-0 mr-3 mt-3 rounded-circle"
                                style="width: 60px;height:60px;">
                            <div class="d-flex align-items-center">
                                <a href="/conversation.html" class="align-self-center profile-link online">
                                    <h4 class="media-heading" id="">You currently have no friends</h4>
                                </a>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
            <br>
            <div>
                <a href="/match.html"><button type="button" class="btn btn-primary btn-lg">Match</button></a>
            </div>
            <br>
        </div>
    </div>
</div>